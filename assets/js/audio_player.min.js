var mediaPlayer=$("#media-player"),title=$("#track-title"),dur_main=$("#dur-main")[0],curr_main=$("#curr-main"),players=$("audio"),playing=-1,played=[],pointer=-1,repeat=!1,footer=$("footer"),stopping=!1;function autoplay(e){var a=players.eq(e),t=a.closest(".music");played=[],pointer=-1,t.addClass("playing active"),a[0].play(),a[0].addEventListener("ended",function(){autoplay(++e)})}function stop(e){e=$(".music.active").find("audio")[0];document.title="!@#$%",stopping=!0,playing=-1,e.pause(),e.currentTime=0,$(e).closest(".music").removeClass("active").removeClass("playing").removeClass("paused"),footer.removeClass("active"),mediaPlayerSpinOut()}function mediaPlayerSpinOut(){mediaPlayer.addClass("spin-out"),mediaPlayer[0].addEventListener("animationend",e=>{mediaPlayer.removeClass("active").removeClass("paused").removeClass("playing").removeClass("spin-out")}),footer.removeClass("active")}function mDur(e){var a=document.getElementById("player-"+e);document.getElementById("dur-"+e).max=a.duration,dur_main.max=a.duration}function mPlay(e){var a=document.getElementById("player-"+e),t=document.getElementById("dur-"+e),i=$("#curr-"+e);t.value=a.currentTime,i.html(a.currentTime),dur_main.value=a.currentTime,curr_main.html(a.currentTime)}function mSet(e,a){var t=document.getElementById(e),i=a,s=a.parent().prev().find(".current-time");t.currentTime=i.val(),s.html(t.currentTime)}$(function(){var e=location.search;if(e){var a=e.split("=")[1];$(".music").each(function(){$(this).addClass("no-match")}),$("#player-"+a).parents(".music").removeClass("no-match").addClass("match").addClass("exact-match")}}),$(".player").on("click",function(e){var a=$(e.target),t=a.parent(),i=t.prev();if(a.hasClass("vol")){var s=i[0].volume.toFixed(1),n=$(".vol-incr"),l=$(".vol-decr");1==s?n.css("opacity",.75):0==s?l.css("opacity",.75):$(".vol").css("opacity",1),t.find(".volume span").html(s)}}),$(".player").each(function(){var e=$(this),a=e.index(),t=e.find("audio"),i=(t[0].currentTime,t[0].duration,$("#curr-"+t.attr("id").split("-")[1])),s=($("#dur-"+t.attr("id").split("-")[1]),e.closest(".music"));e.change(function(){i.html(t[0].currentTime)}),t[0].addEventListener("ended",function(){s.removeClass("playing").removeClass("paused").removeClass("active"),e.eq(a++)&&!stopping?autoplay(a++):stop(),mediaPlayer.removeClass("paused")}),t[0].addEventListener("play",function(){stopping=!1,document.title="Now playing: "+t.data("title"),title.html("Now playing: "+t.data("title")),footer.addClass("active"),playing=players.index($(this)),repeat?repeat=!1:(played.push(playing),pointer++),mediaPlayer.addClass("active").removeClass("paused").addClass("playing"),s.addClass("playing").addClass("active").removeClass("paused")}),t[0].addEventListener("pause",function(){document.title="!@#$%",mediaPlayer.removeClass("playing").addClass("paused"),s.removeClass("playing").addClass("paused"),footer.removeClass("active")})}),$("#shuffle").click(function(){$(".music.playing").each(function(){$(this).find("audio")[0].pause()}),(players=$(".tag.active").length>0?$(".match audio"):$("audio")).sort(function(){return.5-Math.random()}),$(".music-container").toggleClass("shuffle"),played=[],pointer=-1,playing=-1,repeat=!1,players.first()[0].play()}),$("#playall").click(function(){$(".music.playing").each(function(){$(this).find("audio")[0].pause()}),(players=$(".tag.active").length>0?$(".match audio"):$("audio")).first()[0].play()}),$(".music").click(function(e){if($(e.target).hasClass("close")){var a=$(this),t=a.find("audio");a.hasClass("playing")&&(t[0].pause(),t[0].currentTime=0,t.removeClass("active").removeClass("paused").removeClass("playing"),mediaPlayerSpinOut())}}),mediaPlayer.click(function(e){var a=$(e.target),t=-1;if(a.hasClass("next")||a.hasClass("prev")){var i=players.eq(playing),s=i.closest(".music");a.hasClass("next")?-1!=pointer&&pointer<played.length-1?(t=played[++pointer],repeat=!0):t=players.eq(playing+1).length>0?playing+1:0:pointer>0&&(repeat=!0,t=played[--pointer]),-1!=t&&(s.removeClass("active"),s.hasClass("playing")&&i[0].pause(),i[0].currentTime=0,players.eq(t)[0].play())}});