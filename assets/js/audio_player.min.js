var mediaPlayer=$("#media-player"),title=$("#track-title"),dur_main=$("#dur-main")[0],curr_main=$("#curr-main"),players=$("audio"),playing=-1,played=[],played_pointer=-1,repeat=!1;function autoplay(e){var a=players.eq(e),t=a.parent().parent();t.addClass("playing active"),a[0].play(),a[0].addEventListener("ended",function(){autoplay(++e)}),t.find(".close").click(function(){autoplay(++e)})}function mDur(e){var a=document.getElementById("player-"+e);document.getElementById("dur-"+e).max=a.duration,dur_main.max=a.duration}function mPlay(e){var a=document.getElementById("player-"+e),t=document.getElementById("dur-"+e),l=$("#curr-"+e);t.value=a.currentTime,l.html(a.currentTime),dur_main.value=a.currentTime,curr_main.html(a.currentTime)}function mSet(e,a){var t=document.getElementById(e),l=a,n=a.parent().prev().find(".current-time");t.currentTime=l.val(),n.html(t.currentTime)}$(".player").on("click",function(e){var a=$(e.target),t=a.parent(),l=t.prev();if(a.hasClass("vol")){var n=l[0].volume.toFixed(1),i=$(".vol-incr"),r=$(".vol-decr");1==n?i.css("opacity",.75):0==n?r.css("opacity",.75):$(".vol").css("opacity",1),t.find(".volume span").html(n)}}),$(".player").each(function(){var e=$(this),a=e.index(),t=e.find("audio"),l=(t[0].currentTime,t[0].duration,$("#curr-"+t.attr("id").split("-")[1])),n=($("#dur-"+t.attr("id").split("-")[1]),e.parent());e.change(function(){l.html(t[0].currentTime)}),t[0].addEventListener("ended",function(){n.removeClass("playing").removeClass("active"),e.eq(a++)?autoplay(a++):(document.title="!@#$%",playing=-1),mediaPlayer.removeClass("paused")}),t[0].addEventListener("play",function(){console.log(played),console.log(played_pointer),document.title="Now playing: "+t.data("title"),title.html("Now playing: "+t.data("title")),playing=$(this).parent().parent().index(),repeat?repeat=!1:(played.push(playing),played_pointer++),mediaPlayer.addClass("active").removeClass("paused").addClass("playing"),n.addClass("playing").addClass("active").removeClass("paused")}),t[0].addEventListener("pause",function(){document.title="!@#$%",mediaPlayer.removeClass("playing").addClass("paused"),n.removeClass("playing").addClass("paused")})}),$("#playall").click(function(){$(".music.playing").each(function(){$(this).find("audio")[0].pause()}),$(".tag.active").length>0&&(players=$(".match audio")),players.first()[0].play()}),$(".music").click(function(e){if($(e.target).hasClass("close")){var a=$(this).find("audio");a[0].pause(),a[0].currentTime=0,a.removeClass("active").removeClass("paused").removeClass("playing"),mediaPlayer.removeClass("active")}}),mediaPlayer.click(function(e){var a=$(e.target),t=-1;if(a.hasClass("next")||a.hasClass("prev")){var l=players.eq(playing),n=l.parent().parent();a.hasClass("next")?-1!=played_pointer&&played_pointer<played.length-1?(t=played[++played_pointer],repeat=!0):players.eq(playing+1).length>0&&(t=playing+1):played_pointer>0&&(repeat=!0,t=played[--played_pointer]),-1!=t&&(n.removeClass("active"),n.hasClass("playing")&&l[0].pause(),l[0].currentTime=0,players.eq(t)[0].play())}});